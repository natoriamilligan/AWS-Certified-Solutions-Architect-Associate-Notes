# Load Balancers
## Scalability
  
  ### Vertical Scalability
  - increasing the size of an instance

  ### Horizontal Scalability (scale out or scale in)
  - increasing the number of instances
  - implies you have distributed systems

  ## Availability

  ### High Availability
  - usually goes hand in hand with horizontal scaling
  - running your app/instances for the same app in at least 2 data centers or two AZs
  - goal is to survive data loss
  - can be passive or active

  ## Load Balacing (Elastic Load Balancer)
  - servers that forward traffic to multiple servers (instances) downstream
  - the more users you have the more the load is going to be balacned accross instances but your users dont know what instances they are using.
  - expose a single point of access for your app (DNS)
  - handles dailures of downstream instances
  - can do health checks on instances
    - the ELB can provide the checks on the instance. If the instance isnt working, no traffic will be sent to it
  - provides ssl termination for your website
  - high avalabilty accros zones
  - separate public and private traffic
  - AWS guaratees that it will be working
  - AWs provides only a few configuration knobs
  - costs less than managing your own load balancer
  - ELB is intergrated with so many services in AWS
    ### Security Groups with ELB
    - users can access the balancer from anywhere
    - The EC2 instances only allow traffic from the ELB (security group to security group to connect)

    ### Types of Load Balancers
      - best to use new generations
      - can setup internal or external ELBs
      #### Application Load Balancer (v2 new gen 2016 ALB)
      - Layer 7 (HTTP)
      - load balancing to multiple HTTP apps accross machines
      - load balancig to mupliple apps on the same machine (containers)
      - support for HTTP/2 and WebSocket
      - Supports redirects (HTTP to HTTPs for exmaple)
      - load balancer gets a fixed hostname (URL)
      - app servers dont see the IP of the client directly which means the instances through the balancer can see the client who sent the load directly. They have to look at extra headers in the request. This is through listeners and rules
        - the true IP of the client is inserted in the header called X-Forward-For
        - we can also get the port with the header > (X-Forward-port) and protocol used with the header > (X-forwarded-proto)
      - Routing tables to different target groups
        - routing based on path in URL (you can redirect these paths to different target groups)
        - routing based on hostname in URL
        - routing based on Query String, Headers
        - A great fit for micro services and container based apps (Docker and Amazon ECS)
        - has port mapping feature to redirect to a dynamic port in ECS
        - in comparison we would need multiple classic load balancers per app
      **What are target groups?**
        TYPES
        - EC2 instances (managed by Auto Scaling Group) - HTTP
        - ECs tasks (managed by ECS itself) - HTTP
        - lambda functions - HTTP request is translated ina JSOM format
        - IP addresses - must be private IPs
        ********
        - ALB can route to multiple target groups
        - health checks are at the target group level
  
       
      #### Network Load Balancer (v2 new gen 2017 NLB)
      - Layer 4 : TCP and UDP traffic
      - handle millions fo requests per seconds
      - ultra-low latency
      - has one static IP per ZA and supprots assigning Elastic IP
      - used for extreme performance, TCP or UDP, static IPs
        Target Groups
      - EC2 instances
      - IP addresses - must be private
      - can have a network load balancer in front of an ALB
      - heath checks support the TCP , HTTP and HTTPS protocols
        
      #### Gateway Load Balancer (2020 GWLB)
      - Layer 3 (lowest level) (network Layer)
        - IP packets
      - use GENEVE protocol 6081
      - used to deploy, scale and manage a fleet of network virtual apps in AWS
      - used if you want all traffic to go through a firewall or something else (wanting the traffic to be inspected)
      - the traffic will go through the GWLB then the GWLB spreads the traffic to 3rd party virutal appliances. If they are happy the GWLB then sends the traffic to the app/instances
        Target Groups
        - EC2 instances
        - IPs : Ips must be private
          
    ### Sticky Sessions (Session Affinity)
    - same client is always redirected to the same instance behind the load balancer
    - works for all the LBs except GWLB
    - the "cookie" used to stickiness has a expiration date you control
    - use case : make sure the user doesnt lose his session data
    - may bring imbalance to the load
      #### Cookie Names
      - Application-based Cookies
        - custom cookie
          - generated by the target
          - can include custom attributes required by the app
          - cookie name must be specified individually for each target group
          - dont use AWSALB, AWSALBAPP or AWDALBTG (reserved by the ELB)
        - Application Cookie
          - generated by the load balancer
          - cookie name is AWSALBAPP
         
      - Duration-based Cookies
        - cookie generated by the load balancer
        - cookie name is AWSALB for ALB, AWSELB for CLB



















    
